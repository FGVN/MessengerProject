@page "/"
@inject FindUsersQueryHandler queryHandler

<AuthorizeView>
    <NotAuthorized>
        <h1>Hello, world!</h1>
        Welcome to your new app.
        <SurveyPrompt Title="How is Blazor working for you?" />
    </NotAuthorized>
    <Authorized>
        
    </Authorized>
</AuthorizeView>

<form @onsubmit="HandleSearch">
    <MatTextField @bind-Value="Query" Label="Search" Dense="true" />
    <MatButton Type="submit" Raised="true" Dense="true">Search</MatButton>
</form>
<MatTable Items="@users">
    <MatTableHeader>
        <th>Username</th>
        <th>Email</th>
    </MatTableHeader>
    <MatTableRow>
        <td>@context.Username</td>
        <td>@context.Email</td>
    </MatTableRow>
</MatTable>
@code {
    private string Query { get; set; }
    private IEnumerable<UserMenuItem> users;
    private int PageNumber = 1;
    private int totalUsersCount;

    private async Task HandleSearch()
    {
        PageNumber = 1;
        await LoadUsers();
    }

    private async Task LoadUsers()
    {
        var findUsersQuery = new FindUsersQuery
        {
            Query = Query,
            SortBy = "username", 
            SortDirection = "asc", 
            //FIX
            From = 0,
            To = 100
        };
        var result = await queryHandler.Handle(findUsersQuery, PageNumber);
        users = result; // Assuming the result is a paginated response with 'Items' property containing users
        totalUsersCount = result.Count();
        StateHasChanged();
    }

    private async Task HandlePageChange(int newPageIndex)
    {
        PageNumber = newPageIndex + 1;
        await LoadUsers();
    }
}
